/* 21/08/2010 - Início - Vagner
Esse arquivo deve ser atualizado pelos membros do grupo a cada atualização no banco de dados. Cada contraint, campo, tabela criada, alterada ou excluída, os scripts devem 
constar neste arquivo. A cada update feito no repositório, o arquivo Altera_Banco deve ser rodado com as atualizações feitas no banco de dados.
Isso serve pra que todos os membros do grupo mantenham sempre a mesma estrutura de banco de dados.
*/

/* Alteração das constraint do banco de dados para Cascade. Não está previsto que seja excluído nenhuma informação do banco de dados, porém as constraint já estão preparadas para tal funcionamento. 
O banco de dados será colocado no repositório já com as Lojas cadastradas assim como os preços de cada uma. Favor atualizar o seu banco com esta versão.
Foi criado usuários padrões para o utilização no CPS, sendo que o usuário admin será o usuário para administração e alteração das parametrizações. Para teste utilize os usuários com os vossos nomes e senha 1234 */

ALTER TABLE tabelas.lista_produto_item DROP CONSTRAINT fk_lista_produto_item_lista_produto;

ALTER TABLE tabelas.lista_produto_item
  ADD CONSTRAINT fk_lista_produto_item_lista_produto FOREIGN KEY (id_lista)
      REFERENCES tabelas.lista_produto (id_lista) MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE tabelas.lista_produto_item DROP CONSTRAINT fk_lista_produto_item_produto_geral;

ALTER TABLE tabelas.lista_produto_item
  ADD CONSTRAINT fk_lista_produto_item_produto_geral FOREIGN KEY (codigo_barras)
      REFERENCES tabelas.produtogeral (codigo_barras) MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE tabelas.preco DROP CONSTRAINT fk_preco;

ALTER TABLE tabelas.preco
  ADD CONSTRAINT fk_preco FOREIGN KEY (codigo_barras, id_loja, id_rede)
      REFERENCES tabelas.produto (codigo_barras, id_loja, id_rede) MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;
      
ALTER TABLE tabelas.produto DROP CONSTRAINT fk_id_loja_produto;

ALTER TABLE tabelas.produto
  ADD CONSTRAINT fk_id_loja_produto FOREIGN KEY (id_loja, id_rede)
      REFERENCES tabelas.loja (id_loja, id_rede) MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;

/* 21/08/2010 - Início - Vagner
Esse arquivo deve ser atualizado pelos membros do grupo a cada atualização no banco de dados. Cada contraint, campo, tabela criada, alterada ou excluída, os scripts devem 
constar neste arquivo. A cada update feito no repositório, o arquivo Altera_Banco deve ser rodado com as atualizações feitas no banco de dados.
Isso serve pra que todos os membros do grupo mantenham sempre a mesma estrutura de banco de dados.
*/

/* Alteração das constraint do banco de dados para Cascade. Não está previsto que seja excluído nenhuma informação do banco de dados, porém as constraint já estão preparadas para tal funcionamento. 
O banco de dados será colocado no repositório já com as Lojas cadastradas assim como os preços de cada uma. Favor atualizar o seu banco com esta versão.
Foi criado usuários padrões para o utilização no CPS, sendo que o usuário admin será o usuário para administração e alteração das parametrizações. Para teste utilize os usuários com os vossos nomes e senha 1234 */

ALTER TABLE tabelas.lista_produto_item DROP CONSTRAINT fk_lista_produto_item_lista_produto;

ALTER TABLE tabelas.lista_produto_item
  ADD CONSTRAINT fk_lista_produto_item_lista_produto FOREIGN KEY (id_lista)
      REFERENCES tabelas.lista_produto (id_lista) MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE tabelas.lista_produto_item DROP CONSTRAINT fk_lista_produto_item_produto_geral;

ALTER TABLE tabelas.lista_produto_item
  ADD CONSTRAINT fk_lista_produto_item_produto_geral FOREIGN KEY (codigo_barras)
      REFERENCES tabelas.produtogeral (codigo_barras) MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE tabelas.preco DROP CONSTRAINT fk_preco;

ALTER TABLE tabelas.preco
  ADD CONSTRAINT fk_preco FOREIGN KEY (codigo_barras, id_loja, id_rede)
      REFERENCES tabelas.produto (codigo_barras, id_loja, id_rede) MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;
      
ALTER TABLE tabelas.produto DROP CONSTRAINT fk_id_loja_produto;

ALTER TABLE tabelas.produto
  ADD CONSTRAINT fk_id_loja_produto FOREIGN KEY (id_loja, id_rede)
      REFERENCES tabelas.loja (id_loja, id_rede) MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;
      
/* 21/08/2010 - Fim - Vagner */


*/ 02/09/2010 - Inicio - Vagner */

alter table tabelas.parametrizacao_cps add valormediocombustivel float;
alter table tabelas.parametrizacao_cps add rendimentomediocombustivel float;

CREATE TABLE TABELAS.LOCALIZACAO (
  Country varchar(2) NOT NULL,
  Language varchar(2) NOT NULL,
  ID bigint[20] NOT NULL,
  ISO2 varchar(6) NOT NULL,
  Region1 varchar(60) NOT NULL,
  Region2 varchar(60) NOT NULL,
  Region3 varchar(60) NOT NULL,
  Region4 varchar(60) NOT NULL,
  ZIP varchar(10) NOT NULL,
  City varchar(60) NOT NULL,
  Area1 varchar(80) NOT NULL,
  Area2 varchar(80) NOT NULL,
  Lat float NOT NULL,
  Lng float NOT NULL,
  TZ varchar(30) NOT NULL,
  UTC varchar(10) NOT NULL,
  DST varchar(1) NOT NULL,
	constraint pk_localizacao primary key (ID)
)

/* 02/09/2010 - Fim - Vagner */